/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package Classes;

import java.util.ArrayList;
import java.util.HashMap;
import javax.swing.JOptionPane;
import oru.inf.InfDB;
import oru.inf.InfException;

/**
 *
 * @author Kasper
 */
public class Getter {
    private static InfDB hwdb;
    
    public static String getUser(int id, InfDB hwdb){
        String st = "";
        
        try{
            st = hwdb.fetchSingle("select * from larare where LARAR_ID =" + id);
            
            return st;
        }
        catch(InfException e){
            
            JOptionPane.showMessageDialog(null, "Error1");
            st = "Error1";
            return st;
        }
    }
    public static String getUsername(int id, InfDB hwdb){
        String st = "";
        try{
            st = hwdb.fetchSingle("SELECT FORNAMN FROM LARARE where larar_id =" + id);
            return st;
        }
        catch(InfException e){
            JOptionPane.showMessageDialog(null, "Error2");
            st = "Error2";
            return st;
        }
    }
    
    public static String getUserID(InfDB hwdb, String firstname, String surname){
        String id ="";
        try{
            id = hwdb.fetchSingle("SELECT LARAR_ID FROM LARARE WHERE FORNAMN = " + "'" + firstname + "'" + " AND EFTERNAMN = " + "'" + surname + "'");
            return id;
        }
        catch(InfException e){
            JOptionPane.showMessageDialog(null, "Error2");
            id = "error";
        }
        return id;
    }
            
    public static boolean getFirstnameTeacher(int id, InfDB hwdb){
        
        try{
            hwdb.fetchSingle("select name from larare where LARAR_ID=" + id);
            return true;
        }
        catch(Exception e){
            
            JOptionPane.showMessageDialog(null, "Error");
            
            return false;
        }
    }
    public static char[] getPassword(String id, InfDB hwdb){
        String st ="";
        char[] c = null;
        try{
            st = hwdb.fetchSingle("select losenord from larare where larar_id=" + id);
            c = st.toCharArray();
            return c;
        }
        catch(InfException e){
            JOptionPane.showMessageDialog(null, "Error2");
            st = "Error2";
            return c;
        }
    }
    
    public static String getEleverFromElevhem(InfDB db, String dormitory) {
        ArrayList<HashMap<String,String>> students;
        String st = "";
        int index = 1;
        
        
        try{
            students = db.fetchRows("SELECT fornamn,efternamn FROM ELEV join sovsal on sovsal_ID = sovsal join elevhem on elevhem = elevhem_ID where elevhemsnamn = '" + dormitory + "'");
            for(HashMap<String,String> elev : students){
                st += index++ + ". " + elev.get("FORNAMN") + " " + elev.get("EFTERNAMN") + "\n";
            }
        }
        catch(InfException e){
            System.out.println("Error3");
            st ="Error";
        }
        return st;
    }
    
    public static String getCourseAndTeacher(InfDB db, String startDate, String stopDate, String firstname, String surname){
        ArrayList<HashMap<String,String>> courses;
        String st = "";

        try{
            courses = db.fetchRows("SELECT kursnamn,kursstart,kursslut FROM KURS join larare on KURSLARARE = LARAR_ID WHERE FORNAMN = "
                    + "'" + firstname + "'" + " and EFTERNAMN = " + "'" + surname + "'" + " and KURSSTART >= " + "'" + startDate + "'"
            + " and KURSSLUT <= " + "'" + stopDate + "'");
            for(HashMap<String,String> course : courses){
                st += course.get("KURSNAMN") + " from " + course.get("KURSSTART") + " to " + course.get("KURSSLUT") + "\n";
                
            }
        }
        catch(Exception e){
             st = "Error";
             System.out.println(e);
        }
        return st;
    }
    
    public static String getElevhemspokalen(InfDB db){
        ArrayList<HashMap<String, String>> pokal;
        String st = "";
        int index = 1;
        
        try{
            pokal = db.fetchRows("SELECT Elevhemsnamn, Huspoang FROM Elevhem ORDER BY Huspoang DESC");
            for(HashMap<String, String> pokalen : pokal){
                st += index++ + ". " + pokalen.get("ELEVHEMSNAMN") + " " + "Poäng: " + pokalen.get("HUSPOANG") + "\n";
            }
        }
        catch(Exception e){
            System.out.println("Error pokal");
        }
        return st;
    }
    
    public static String getCourseAndStudent(InfDB db, String firstname, String surname){
        ArrayList<HashMap<String, String>> student;
        String st = "";
        
        try{
            student = db.fetchRows("SELECT KURSNAMN FROM ELEV JOIN REGISTRERAD_PA ON ELEV.ELEV_ID = REGISTRERAD_PA.ELEV_ID JOIN KURS ON REGISTRERAD_PA.KURS_ID = KURS.KURS_ID WHERE"
                    + " FORNAMN = '" + firstname + 
                    "'"  + " AND EFTERNAMN = '" + surname + "'");
            st = firstname + " " + surname + " " + "är registrerad på följande kurser:" + "\n";
            for(HashMap<String, String> stt : student){
                st += stt.get("KURSNAMN") + "\n";
            }
            
        }
        catch(InfException e){
            System.out.println("Error student course");
        }
        return st;
    }
    
    public static String getCourseGrade(InfDB db, String firstname, String surname, String course){
        HashMap<String, String> student;
        String st = "";
        
        try{
            student = db.fetchRow("SELECT KURSNAMN, KURSBETYG FROM KURS JOIN HAR_BETYG_I ON HAR_BETYG_I.KURS_ID = KURS.KURS_ID JOIN ELEV ON ELEV.ELEV_ID = HAR_BETYG_I.ELEV_ID"
                    + " WHERE ELEV.FORNAMN = " + "'" + firstname + "'" + " AND ELEV.EFTERNAMN = " + "'" + surname + "'" + " AND KURS.KURSNAMN = " + "'" + course + "'");
            for(int i = 1; i< student.size();i++){
                st += "Kurs: " + student.get("KURSNAMN") + " Betyg: " + student.get("KURSBETYG");
            }
        }
        catch(Exception e){
            st = "Error betyg, elev.";
        }
        return st;
    }
}
